{
  "resourceType": "Library",
  "id": "DataElementHelpers",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://somewhere.org/fhir/uv/onccovid19ml/Library/DataElementHelpers",
  "version": "1.0.0",
  "name": "DataElementHelpers",
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBEYXRhRWxlbWVudEhlbHBlcnMgdmVyc2lvbiAnMS4wLjAnCgp1c2luZyBGSElSIHZlcnNpb24gJzQuMC4xJwoKaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjEuMDAwJwppbmNsdWRlIFVTQ29yZUNvbW1vbiB2ZXJzaW9uICcwLjEuMCcgY2FsbGVkIFVDCgpjb2Rlc3lzdGVtICJMT0lOQyI6ICdodHRwOi8vbG9pbmMub3JnJwpjb2RlICJCbG9vZCBwcmVzc3VyZSI6ICc4NTM1NC05JyBmcm9tICJMT0lOQyIgZGlzcGxheSAnQmxvb2QgcHJlc3N1cmUgc3lzdG9saWMgYW5kIGRpYXN0b2xpYycKY29kZSAiU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUiOiAnODQ4MC02JyBmcm9tICJMT0lOQyIgZGlzcGxheSAnU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUnCmNvZGUgIkRpYXN0b2xpYyBibG9vZCBwcmVzc3VyZSI6ICc4NDYyLTQnIGZyb20gIkxPSU5DIiBkaXNwbGF5ICdEaWFzdG9saWMgYmxvb2QgcHJlc3N1cmUnCgpwYXJhbWV0ZXIgQXNPZiBEYXRlVGltZSBkZWZhdWx0IE5vdygpCgovKgogKiBSZXBvcnQgc3VtbWFyeSBoZWxwZXJzCiAqLwoKLy8gZGlzcGxheU5hbWU6IFBhdGllbnQtZnJpZW5kbHkgbmFtZSBmb3IgZGlzcGxheSwgdXN1YWxseSBiYXNlZCBvbiB2YWx1ZSBzZXQgY2xhc3NpZmllci4KZGVmaW5lIGZ1bmN0aW9uIERhdGFFbGVtZW50U3VtbWFyeShyZXNvdXJjZSBSZXNvdXJjZSwgZGlzcGxheU5hbWUgU3RyaW5nKTogCiAgaWYgKHJlc291cmNlIGlzIG51bGwpIHRoZW4gbnVsbAogIGVsc2UKICB7CiAgICBEaXNwbGF5TmFtZTogQ29hbGVzY2UoZGlzcGxheU5hbWUsIERpc3BsYXlOYW1lKHJlc291cmNlKSksICAgCiAgICBDb25jZXB0TmFtZTogRGlzcGxheU5hbWUocmVzb3VyY2UpLAogICAgU29ydERhdGU6IFNvcnREYXRlKHJlc291cmNlKSwKICAgIFJlc291cmNlOiByZXNvdXJjZQogIH0KCmRlZmluZSBmdW5jdGlvbiBEYXRhRWxlbWVudChyZXNvdXJjZSBSZXNvdXJjZSk6IAogIGlmIChyZXNvdXJjZSBpcyBudWxsKSB0aGVuIG51bGwKICBlbHNlCiAgeyAgCiAgICBEaXNwbGF5TmFtZTogRGlzcGxheU5hbWUocmVzb3VyY2UpCiAgICAvLyBSZXNvdXJjZTogcmVzb3VyY2UKICB9CgovLyBSZXR1cm5zIGEgbGlzdCBvZiBkYXRhIGVsZW1lbnQgc3VtbWFyaWVzIGZvciB0aGVzZSByZXNvdXJjZXMuCmRlZmluZSBmdW5jdGlvbiBEYXRhRWxlbWVudHMocmVzb3VyY2VzIExpc3Q8RkhJUi5SZXNvdXJjZT4pOgogIHJlc291cmNlcyBSCiAgICByZXR1cm4gRGF0YUVsZW1lbnQoUikKCi8vIFJldHVybnMgYSBwbGFpbiB0ZXh0IGRpc3BsYXkgbmFtZSBmb3IgdGhpcyBGSElSIHJlc291cmNlLgpkZWZpbmUgZnVuY3Rpb24gRGlzcGxheU5hbWUocmVzb3VyY2UgUmVzb3VyY2UpOgogIENvYWxlc2NlKAogICAgQ29hbGVzY2UoCiAgICAgIC8vIENvYWxlc2NlIGlzIGxpbWl0ZWQgdG8gNSBhcmd1bWVudHMKICAgICAgQ29uY2VwdFRleHQoKHJlc291cmNlIGFzIENvbmRpdGlvbikuY29kZSksCiAgICAgIENvbmNlcHRUZXh0KChyZXNvdXJjZSBhcyBHb2FsKS5kZXNjcmlwdGlvbiksCiAgICAgIENvbmNlcHRUZXh0KChyZXNvdXJjZSBhcyBNZWRpY2F0aW9uUmVxdWVzdCkubWVkaWNhdGlvbiBhcyBDb2RlYWJsZUNvbmNlcHQpLAogICAgICBDb25jZXB0VGV4dCgocmVzb3VyY2UgYXMgT2JzZXJ2YXRpb24pLmNvZGUpLAogICAgICBDb25jZXB0VGV4dCgocmVzb3VyY2UgYXMgUHJvY2VkdXJlKS5jb2RlKQogICAgKSwKICAgIENvbmNlcHRUZXh0KChyZXNvdXJjZSBhcyBTZXJ2aWNlUmVxdWVzdCkuY29kZSkKICApCgovLyBSZXR1cm5zIGEgbGlzdCBvZiBkaXNwbGF5IG5hbWVzIGZvciB0aGVzZSByZXNvdXJjZXMsIGZvciBzaW1wbGUgcmVwb3J0aW5nIGFuZCB0ZXN0IGxvZ2dpbmcuCmRlZmluZSBmdW5jdGlvbiBEaXNwbGF5TmFtZXMocmVzb3VyY2VzIExpc3Q8RkhJUi5SZXNvdXJjZT4pOgogIHJlc291cmNlcyBSCiAgICByZXR1cm4gRGlzcGxheU5hbWUoUikKCi8vIFJldHVybnMgYSBkZWZhdWx0IHNvcnQgZGF0ZSBmb3IgdGhpcyBGSElSIHJlc291cmNlLgpkZWZpbmUgZnVuY3Rpb24gU29ydERhdGUocmVzb3VyY2UgUmVzb3VyY2UpOgogIENvYWxlc2NlKAogICAgQ29hbGVzY2UoCiAgICAgIEZpbmRPbnNldERhdGUocmVzb3VyY2UgYXMgQ29uZGl0aW9uKSwgKHJlc291cmNlIGFzIENvbmRpdGlvbikucmVjb3JkZWREYXRlKSwKICAgICAgKHJlc291cmNlIGFzIE1lZGljYXRpb25SZXF1ZXN0KS5hdXRob3JlZE9uLAogICAgICBGaW5kRGF0ZShyZXNvdXJjZSBhcyBPYnNlcnZhdGlvbikKICApCgovLyBSZXR1cm5zIGEgbGlzdCBvZiBQcm92ZW5hbmNlIGZvciBhIHJlc291cmNlCmRlZmluZSBmdW5jdGlvbiBQcm92ZW5hbmNlT2YocmVzb3VyY2UgUmVzb3VyY2UpOgogIFtQcm92ZW5hbmNlXSBQCiAgICB3aGVyZSBleGlzdHMoUC50YXJnZXQgdGFyZ2V0CiAgICAgIHdoZXJlIHJlc291cmNlLmlkID0gR2V0SWQodGFyZ2V0LnJlZmVyZW5jZSkpCgpkZWZpbmUgZnVuY3Rpb24gUmVwb3J0UHJvdmVuYW5jZShyZXNvdXJjZSBSZXNvdXJjZSk6CiAgKFByb3ZlbmFuY2VPZihyZXNvdXJjZSkpIFAKICAgIHJldHVybiB7CiAgICAgIFRyYW5zbWl0dGVyOiBQcm92ZW5hbmNlVHJhbnNtaXR0ZXIoUCksCiAgICAgIEF1dGhvcjogUHJvdmVuYW5jZUF1dGhvcihQKQogICAgfQoKZGVmaW5lIGZ1bmN0aW9uIFByb3ZlbmFuY2VUcmFuc21pdHRlcihwcm92ZW5hbmNlIFByb3ZlbmFuY2UpOgogIChwcm92ZW5hbmNlLmFnZW50KSBBCiAgICB3aGVyZSBBLnR5cGUuY29kaW5nWzBdLmNvZGUgPSAndHJhbnNtaXR0ZXInCiAgICByZXR1cm4gQS53aG8uZGlzcGxheS52YWx1ZQoKZGVmaW5lIGZ1bmN0aW9uIFByb3ZlbmFuY2VBdXRob3IocHJvdmVuYW5jZSBQcm92ZW5hbmNlKToKICAocHJvdmVuYW5jZS5hZ2VudCkgQQogICAgd2hlcmUgQS50eXBlLmNvZGluZ1swXS5jb2RlID0gJ2F1dGhvcicKICAgIHJldHVybiBBLndoby5kaXNwbGF5LnZhbHVlCgpkZWZpbmUgZnVuY3Rpb24gUmVwb3J0Q29uZGl0aW9ucyhjb25kaXRpb25zIExpc3Q8Q29uZGl0aW9uPiwgY2F0ZWdvcnkgU3RyaW5nLCBjb21tb25OYW1lIFN0cmluZyk6CiAgY29uZGl0aW9ucyBDCiAgICByZXR1cm4gUmVwb3J0Q29uZGl0aW9uKEMsIGNhdGVnb3J5LCBjb21tb25OYW1lKQogIApkZWZpbmUgZnVuY3Rpb24gUmVwb3J0Q29uZGl0aW9uKGNvbmRpdGlvbiBDb25kaXRpb24sIGNhdGVnb3J5IFN0cmluZywgY29tbW9uTmFtZSBTdHJpbmcpOgogIHsKICAgIGlkOiBjb25kaXRpb24uaWQudmFsdWUsCiAgICBDYXRlZ29yeTogY2F0ZWdvcnksCiAgICBDb21tb25OYW1lOiBjb21tb25OYW1lLAogICAgQ29uY2VwdE5hbWU6IENvbmNlcHRUZXh0KGNvbmRpdGlvbi5jb2RlKSwKICAgIENvZGVhYmxlQ29uY2VwdDogY29uZGl0aW9uLmNvZGUsCiAgICBSZWNvcmRlZERhdGU6IFRvU3RyaW5nKGNvbmRpdGlvbi5yZWNvcmRlZERhdGUpLAogICAgQXNzZXJ0ZWREYXRlOiBudWxsLCAvLyBUT0RPIGdldCBkYXRlIGZyb20gZXh0ZW50aW9uOyBzZWUgVVMgQ29yZSBwcm9maWxlCiAgICAvLyBodHRwOi8vaGw3Lm9yZy9maGlyL1N0cnVjdHVyZURlZmluaXRpb24vY29uZGl0aW9uLWFzc2VydGVkRGF0ZSAoZGF0ZVRpbWUgdHlwZSkKICAgIE9uc2V0RGF0ZTogVG9TdHJpbmcoRmluZE9uc2V0RGF0ZShjb25kaXRpb24pKSwKICAgIFJlY29yZGVyOiBjb25kaXRpb24ucmVjb3JkZXIuZGlzcGxheS52YWx1ZSwKICAgIEFzc2VydGVyOiBjb25kaXRpb24uYXNzZXJ0ZXIuZGlzcGxheS52YWx1ZSwKICAgIE5vdGVzOiBUb1N0cmluZyhjb25kaXRpb24ubm90ZSksCiAgICBQcm92ZW5hbmNlOiBSZXBvcnRQcm92ZW5hbmNlKGNvbmRpdGlvbiksCiAgICBMZWFybk1vcmU6IExlYXJuTW9yZVVSTChjb25kaXRpb24uY29kZSkKICB9CgovLyBSZXR1cm5zIGEgbGlzdCBvZiBHb2FscyB0aGF0IGFkZHJlc3MgdGhpcyBDb25kaXRpb24KZGVmaW5lIGZ1bmN0aW9uIEhhc0dvYWxzKGNvbmRpdGlvbiBDb25kaXRpb24pOgogIFtHb2FsXSBnb2FsCiAgICB3aGVyZSBleGlzdHMoZ29hbC5hZGRyZXNzZXMgR0EKICAgICAgd2hlcmUgY29uZGl0aW9uLmlkID0gR2V0SWQoR0EucmVmZXJlbmNlKSkKCmRlZmluZSBmdW5jdGlvbiBSZXBvcnRNZWRpY2F0aW9ucyhtZWRSZXF1ZXN0cyBMaXN0PE1lZGljYXRpb25SZXF1ZXN0PiwgY2F0ZWdvcnkgU3RyaW5nKToKICBtZWRSZXF1ZXN0cyBNCiAgICByZXR1cm4gUmVwb3J0TWVkaWNhdGlvbihNLCBjYXRlZ29yeSkKCmRlZmluZSBmdW5jdGlvbiBSZXBvcnRNZWRpY2F0aW9uKG1lZFJlcSBNZWRpY2F0aW9uUmVxdWVzdCwgY2F0ZWdvcnkgU3RyaW5nKToKICB7CiAgICAvLyBUT0RPOiBzdXBwb3J0IE1lZGljYXRpb24gcmVmZXJlbmNlCiAgICBDYXRlZ29yeTogY2F0ZWdvcnksCiAgICBDb25jZXB0TmFtZTogQ29hbGVzY2UoQ29uY2VwdFRleHQobWVkUmVxLm1lZGljYXRpb24gYXMgQ29kZWFibGVDb25jZXB0KSwgKG1lZFJlcS5tZWRpY2F0aW9uIGFzIFJlZmVyZW5jZSkuZGlzcGxheS52YWx1ZSksCiAgICBBdXRob3JlZE9uOiBUb1N0cmluZyhtZWRSZXEuYXV0aG9yZWRPbiksCiAgICBSZXF1ZXN0ZXI6IG1lZFJlcS5yZXF1ZXN0ZXIuZGlzcGxheS52YWx1ZSwKICAgIERvc2FnZUluc3RydWN0aW9uOiBDb2FsZXNjZShGaXJzdChtZWRSZXEuZG9zYWdlSW5zdHJ1Y3Rpb24pLnRleHQudmFsdWUsIEZpcnN0KG1lZFJlcS5kb3NhZ2VJbnN0cnVjdGlvbikucGF0aWVudEluc3RydWN0aW9uLnZhbHVlKSwKICAgIE5vdGVzOiBUb1N0cmluZyhtZWRSZXEubm90ZSksCiAgICBQcm92ZW5hbmNlOiBSZXBvcnRQcm92ZW5hbmNlKG1lZFJlcSksCiAgICBMZWFybk1vcmU6IExlYXJuTW9yZVVSTChtZWRSZXEubWVkaWNhdGlvbiBhcyBDb2RlYWJsZUNvbmNlcHQpCiAgfQoKZGVmaW5lIGZ1bmN0aW9uIFJlcG9ydE1vc3RSZWNlbnRSZXN1bHQob2JzZXJ2YXRpb25zIExpc3Q8T2JzZXJ2YXRpb24+KToKICBSZXBvcnRPYnNlcnZhdGlvbihNb3N0UmVjZW50KG9ic2VydmF0aW9ucyksIG51bGwpCgpkZWZpbmUgZnVuY3Rpb24gUmVwb3J0TW9zdFJlY2VudFJlc3VsdChvYnNlcnZhdGlvbnMgTGlzdDxPYnNlcnZhdGlvbj4sIGRpc3BsYXlOYW1lIFN0cmluZyk6CiAgUmVwb3J0T2JzZXJ2YXRpb24oTW9zdFJlY2VudChvYnNlcnZhdGlvbnMpLCBkaXNwbGF5TmFtZSkKCmRlZmluZSBmdW5jdGlvbiBTZWxlY3RBY3RpdmVNZWRpY2F0aW9ucyhtZWRSZXF1ZXN0cyBMaXN0PE1lZGljYXRpb25SZXF1ZXN0Pik6CiAgbWVkUmVxdWVzdHMgTWVkUmVxCiAgICB3aGVyZSBNZWRSZXEuc3RhdHVzIGluIHsnYWN0aXZlJ30KCi8qCmRlZmluZSBmdW5jdGlvbiBNb3N0UmVjZW50UHJvY2VkdXJlKHByb2NlZHVyZXMgTGlzdDxQcm9jZWR1cmU+KToKICBGaXJzdCgKICAgIHByb2NlZHVyZXMgUAogICAgICBzb3J0IGJ5IHN0YXJ0IG9mIFVDLlRvSW50ZXJ2YWwocGVyZm9ybWVkKSBkZXNjZW5kaW5nCiAgKQoKZGVmaW5lIGZ1bmN0aW9uIFBlcmZvcm1lZFdpdGhpbihwcm9jZWR1cmVzIExpc3Q8UHJvY2VkdXJlPiwgbG9va2JhY2sgU3lzdGVtLlF1YW50aXR5KToKICBwcm9jZWR1cmVzIFAKICAgIHdoZXJlIGVuZCBvZiBVQy5Ub0ludGVydmFsKFAucGVyZm9ybWVkKSBvbiBvciBhZnRlciBkYXkgb2YgQXNPZiAtIGxvb2tiYWNrCiovCgovKgogKiBIZWxwZXJzIGZvciBPYnNlcnZhdGlvbiBkYXRhIGVsZW1lbnRzLgogKi8KCi8vLyBUZXN0cyBvbmx5IHRoZSBmaXJzdCBDb2RpbmcgaW4gZ2l2ZW4gQ29kZWFibGVDb25jZXB0CmRlZmluZSBmdW5jdGlvbiBGaW5kT2JzZXJ2YXRpb25zKGNvZGUgRkhJUi5Db2RlYWJsZUNvbmNlcHQpOgogIGlmIGNvZGUgaXMgbnVsbCBvciBjb2RlLmNvZGluZyBpcyBudWxsIHRoZW4gbnVsbAogIGVsc2UKICAgIFtPYnNlcnZhdGlvbl0gbwogICAgICB3aGVyZSBvLmNvZGUgfiBGSElSSGVscGVycy5Ub0NvZGUoY29kZS5jb2RpbmdbMF0pCiAgICAgICAgb3IgZXhpc3RzIG8uY29tcG9uZW50IGMKICAgICAgICAgIHdoZXJlIGMuY29kZSB+IEZISVJIZWxwZXJzLlRvQ29kZShjb2RlLmNvZGluZ1swXSkKCmRlZmluZSBmdW5jdGlvbiBSZXBvcnRPYnNlcnZhdGlvbihvIEZISVIuT2JzZXJ2YXRpb24sIGRpc3BsYXlOYW1lIFN0cmluZyk6CiAgaWYgbyBpcyBudWxsIHRoZW4gbnVsbAogIGVsc2UKICAgIHsKICAgICAgRGlzcGxheU5hbWU6IGRpc3BsYXlOYW1lLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0aWVudC1mcmllbmRseSBkaXNwbGF5IG5hbWUKICAgICAgQ29uY2VwdE5hbWU6ICAgQ29uY2VwdFRleHQoby5jb2RlKSwgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGlzcGxheSBuYW5tZSBmcm9tIGNvZGUKICAgICAgRGF0ZTogICBUb1N0cmluZyhGaW5kRGF0ZShvKSksCiAgICAgIFJlc3VsdFRleHQ6IFJlc3VsdFRleHQobyksICAgICAgICAgLy8gcmVzdWx0IHZhbHVlIHdpdGggdW5pdHMKICAgICAgUmVzdWx0VmFsdWU6IGlmIChvLnZhbHVlIGFzIEZISVIuUXVhbnRpdHkpIGlzIG5vdCBudWxsIHRoZW4gU3lzdGVtLlF1YW50aXR5IHsgdmFsdWU6IChvLnZhbHVlIGFzIEZISVIuUXVhbnRpdHkpLnZhbHVlfS52YWx1ZSBlbHNlIG51bGwsCiAgICAgIFJlc3VsdFVuaXRzOiAoby52YWx1ZSBhcyBGSElSLlF1YW50aXR5KS51bml0LnZhbHVlLAogICAgICBSZWZlcmVuY2VSYW5nZTogUmVmZXJlbmNlUmFuZ2UobyksCiAgICAgIEludGVycHJldGF0aW9uOiBJbnRlcnByZXRhdGlvbihvKSwKICAgICAgRmxhZzogUmVmZXJlbmNlUmFuZ2VGbGFnKG8pLCAgIC8vIHRydWUgaWYgdmFsdWUgb3V0IG9mIHJhbmdlLCBlbHNlIGZhbHNlCiAgICAgIFBlcmZvcm1lcjogRmlyc3Qoby5wZXJmb3JtZXIpLmRpc3BsYXkudmFsdWUsCiAgICAgIE5vdGVzOiBUb1N0cmluZyhvLm5vdGUpLAogICAgICBQcm92ZW5hbmNlOiBSZXBvcnRQcm92ZW5hbmNlKG8pLAogICAgICBMZWFybk1vcmU6IExlYXJuTW9yZVVSTChvLmNvZGUpCiAgICB9CgpkZWZpbmUgZnVuY3Rpb24gUmVzdWx0VGV4dChvIE9ic2VydmF0aW9uKToKICAvLyBJZiBCbG9vZCBwcmVzc3VyZSBvYnNlcnZhdGlvbiwgdGhlbiBleHRyYWN0IGNvbXBvbmVudCB2YWx1ZXMuCiAgaWYgby5jb2RlIH4gIkJsb29kIHByZXNzdXJlIiB0aGVuCiAgICBUb1N0cmluZygoKHNpbmdsZXRvbiBmcm9tIChvLmNvbXBvbmVudCBDIHdoZXJlIChDLmNvZGUgfiAiU3lzdG9saWMgYmxvb2QgcHJlc3N1cmUiKSkpLnZhbHVlIGFzIEZISVIuUXVhbnRpdHkpLnZhbHVlKQogICAgICsgJy8nICsgVG9TdHJpbmcoKChzaW5nbGV0b24gZnJvbSAoby5jb21wb25lbnQgQyB3aGVyZSAoQy5jb2RlIH4gIkRpYXN0b2xpYyBibG9vZCBwcmVzc3VyZSIpKSkudmFsdWUgYXMgRkhJUi5RdWFudGl0eSkudmFsdWUpICsgJyBtbUhnJwogIGVsc2UgaWYgby52YWx1ZSBpcyBGSElSLlF1YW50aXR5IHRoZW4KICAgIFF1YW50aXR5VGV4dChvLnZhbHVlIGFzIEZISVIuUXVhbnRpdHkpCiAgZWxzZSBpZiBvLnZhbHVlIGlzIENvZGVhYmxlQ29uY2VwdCB0aGVuCiAgICBDb25jZXB0VGV4dChvLnZhbHVlIGFzIENvZGVhYmxlQ29uY2VwdCkKICBlbHNlIGlmIG8udmFsdWUgaXMgRkhJUi5zdHJpbmcgdGhlbgogICAgby52YWx1ZSBhcyBGSElSLnN0cmluZwogIGVsc2UKICAgIG51bGwKCmRlZmluZSBmdW5jdGlvbiBTZWxlY3RCeVN0YXR1cyhvYnNlcnZhdGlvbnMgTGlzdDxPYnNlcnZhdGlvbj4pOgogIG9ic2VydmF0aW9ucyBPYnMKCXdoZXJlIE9icy5zdGF0dXMgaW4geydmaW5hbCcsICdhbWVuZGVkJywgJ2NvcnJlY3RlZCcsICdwcmVsaW1pbmFyeSd9CgpkZWZpbmUgZnVuY3Rpb24gTW9zdFJlY2VudChvYnNlcnZhdGlvbnMgTGlzdDxPYnNlcnZhdGlvbj4pOgogIEZpcnN0KAogICAgb2JzZXJ2YXRpb25zIE8KICAgICAgLy8gTm90ZTogQ2Fubm90IHVzZSBGaW5kRGF0ZSgpIGJlY2F1c2UgZXhlY3V0aW9uIGVuZ2luZSBjYW5ub3Qgc29ydCBieSByZXN1bHQgb2YgYSBmdW5jdGlvbi4KICAgICAgc29ydCBieSBDb2FsZXNjZSgKICAgICAgICAoZWZmZWN0aXZlIGFzIEZISVIuZGF0ZVRpbWUpLnZhbHVlLAogICAgICAgIChlZmZlY3RpdmUgYXMgRkhJUi5pbnN0YW50KS52YWx1ZSwKICAgICAgICAoZWZmZWN0aXZlIGFzIEZISVIuUGVyaW9kKS4iZW5kIi52YWx1ZSwKICAgICAgICAoZWZmZWN0aXZlIGFzIEZISVIuUGVyaW9kKS4ic3RhcnQiLnZhbHVlLAogICAgICAgIGlzc3VlZC52YWx1ZSkgZGVzY2VuZGluZwogICkKCmRlZmluZSBmdW5jdGlvbiBJc3N1ZWRXaXRoaW4ob2JzZXJ2YXRpb25zIExpc3Q8T2JzZXJ2YXRpb24+LCBsb29rYmFjayBTeXN0ZW0uUXVhbnRpdHkpOgogIG9ic2VydmF0aW9ucyBPCiAgICB3aGVyZSBPLmlzc3VlZCBvbiBvciBhZnRlciBkYXkgb2YgQXNPZiAtIGxvb2tiYWNrCgpkZWZpbmUgZnVuY3Rpb24gUmVmZXJlbmNlUmFuZ2UobyBGSElSLk9ic2VydmF0aW9uKToKICBpZiAobyBpcyBudWxsIG9yIG8ucmVmZXJlbmNlUmFuZ2UgaXMgbnVsbCkgdGhlbiBudWxsCiAgZWxzZQogICAgQ29hbGVzY2UoRmlyc3Qoby5yZWZlcmVuY2VSYW5nZS50ZXh0KSwKICAgICAgVG9TdHJpbmcoUmVmZXJlbmNlUmFuZ2VMb3cobykpICsgJyAtICcgKyBUb1N0cmluZyhSZWZlcmVuY2VSYW5nZUhpZ2gobykpCiAgICApCgpkZWZpbmUgZnVuY3Rpb24gUmVmZXJlbmNlUmFuZ2VMb3cobyBGSElSLk9ic2VydmF0aW9uKToKICBGaXJzdChvLnJlZmVyZW5jZVJhbmdlKS5sb3cudmFsdWUKCmRlZmluZSBmdW5jdGlvbiBSZWZlcmVuY2VSYW5nZUhpZ2gobyBGSElSLk9ic2VydmF0aW9uKToKICBGaXJzdChvLnJlZmVyZW5jZVJhbmdlKS5oaWdoLnZhbHVlCgpkZWZpbmUgZnVuY3Rpb24gUmVmZXJlbmNlUmFuZ2VGbGFnKG8gRkhJUi5PYnNlcnZhdGlvbik6CiAgaWYgKG8udmFsdWUudmFsdWUgPCBSZWZlcmVuY2VSYW5nZUxvdyhvKQogICAgICBvciBvLnZhbHVlLnZhbHVlID4gUmVmZXJlbmNlUmFuZ2VIaWdoKG8pKSB0aGVuIHRydWUKICBlbHNlIGZhbHNlCgpkZWZpbmUgZnVuY3Rpb24gSW50ZXJwcmV0YXRpb24obyBGSElSLk9ic2VydmF0aW9uKToKICBpZiAoby5pbnRlcnByZXRhdGlvbiBpcyBub3QgbnVsbCkgdGhlbgogICAgQ29hbGVzY2UoRmlyc3Qoby5pbnRlcnByZXRhdGlvbi50ZXh0KSwgRmlyc3QoRmlyc3Qoby5pbnRlcnByZXRhdGlvbikuY29kaW5nLmRpc3BsYXkpKQogIGVsc2UgaWYgby5yZWZlcmVuY2VSYW5nZSBpcyBub3QgbnVsbCB0aGVuCiAgICAvLyBEZXJpdmUgaW50ZXJwcmV0YXRpb24gZnJvbSB0aGUgcmVmZXJlbmNlIHJhbmdlLCByZXR1cm4gbnVsbCBpZiB3aXRoaW4gbm9ybWFsIHJhbmdlLgogICAgaWYgby52YWx1ZS52YWx1ZSA8IFJlZmVyZW5jZVJhbmdlTG93KG8pIHRoZW4gJ0xvdycKICAgIGVsc2UgaWYgby52YWx1ZS52YWx1ZSA+IFJlZmVyZW5jZVJhbmdlSGlnaChvKSB0aGVuICdIaWdoJwogICAgZWxzZSBudWxsCiAgZWxzZQogICAgbnVsbAoKLyoqCiAqIEZpbmRzIHRoZSBmaXJzdCBub24tbnVsbCBtZWFuaW5nZnVsIGRhdGUgdGhhdCBjYW4gYmUgYXNzb2NpYXRlZCB3aXRoIHRoaXMgT2JzZXJ2YXRpb24uICBUaGlzIHdpbGwgbG9vayB0aHJvdWdoIHRoZQogKiBmb2xsb3dpbmcgZmllbGRzIGluIHRoZSBmb2xsb3dpbmcgb3JkZXI6IGVmZmVjdGl2ZURhdGVUaW1lLCBlZmZlY3RpdmVJbnN0YW50LCBlZmZlY3RpdmVQZXJpb2QuZW5kLAogKiBlZmZlY3RpdmVQZXJpb2Quc3RhcnQsIGlzc3VlZC4KICogQHBhcmFtIE9icyAtIGFuIE9ic2VydmF0aW9uCiAqIEByZXR1cm5zIHtTeXN0ZW0uRGF0ZVRpbWV9IHRoZSBmaXJzdCBub24tbnVsbCBtZWFuaW5nZnVsIGRhdGUsIG9yIG51bGwgaWYgbm9uIGlzIGZvdW5kCiAqLwpkZWZpbmUgZnVuY3Rpb24gRmluZERhdGUoT2JzIE9ic2VydmF0aW9uKToKICBDb2FsZXNjZSgKICAgIChPYnMuZWZmZWN0aXZlIGFzIEZISVIuZGF0ZVRpbWUpLnZhbHVlLAogICAgKE9icy5lZmZlY3RpdmUgYXMgRkhJUi5pbnN0YW50KS52YWx1ZSwKICAgIChPYnMuZWZmZWN0aXZlIGFzIEZISVIuUGVyaW9kKS4iZW5kIi52YWx1ZSwKICAgIChPYnMuZWZmZWN0aXZlIGFzIEZISVIuUGVyaW9kKS4ic3RhcnQiLnZhbHVlLAogICAgT2JzLmlzc3VlZC52YWx1ZQogICkKCmRlZmluZSBmdW5jdGlvbiBGaW5kT25zZXREYXRlKENvbmQgQ29uZGl0aW9uKToKICBDb2FsZXNjZSgKICAgIChDb25kLm9uc2V0IGFzIEZISVIuZGF0ZVRpbWUpLnZhbHVlLAogICAgKENvbmQub25zZXQgYXMgRkhJUi5QZXJpb2QpLiJlbmQiLnZhbHVlLAogICAgKENvbmQub25zZXQgYXMgRkhJUi5QZXJpb2QpLiJzdGFydCIudmFsdWUKICApCgovKgogKiBHZW5lcmFsIEZISVIgZGF0YSBoZWxwZXJzLgogKi8KCmRlZmluZSBmdW5jdGlvbiBHZXRJZCh1cmkgU3RyaW5nICk6CiAgTGFzdChTcGxpdCh1cmksICcvJykpCgovLy8gUmV0dXJucyBhbiBhcnJheSBvZiBzdHJpbmdzCmRlZmluZSBmdW5jdGlvbiBUb1N0cmluZyhub3RlcyBMaXN0PEFubm90YXRpb24+KToKICBub3RlcyBOIAogICAgd2hlcmUgTi50ZXh0IGlzIG5vdCBudWxsCiAgICByZXR1cm4gTi50ZXh0LnZhbHVlCgovLyBSZXR1cm5zIHRoZSBmaXJzdC1mb3VuZCBkaXNwbGF5IHRleHQgZm9yIGEgQ29kZWFibGVDb25jZXB0LCBsb29raW5nIGZpcnN0IGF0IHRoZSBgdGV4dGAgYXR0cmlidXRlLCB0aGVuIHRoZQovLyBgZGlzcGxheWAgb24gZWFjaCBgY29kaW5nYCB1bnRpbCBpdCBmaW5kcyBhIG5vbi1udWxsIHZhbHVlLgovLyBAcGFyYW0gYyAtIGEgRkhJUiBDb2RlYWJsZUNvbmNlcHQgdG8gZ2V0IHRleHQgZnJvbQovLyBAcmV0dXJucyB7U3lzdGVtLlN0cmluZ30gdGhlIGRpc3BsYXkgdGV4dCBvciBudWxsIGlmIG5vbmUgaXMgZm91bmQKZGVmaW5lIGZ1bmN0aW9uIENvbmNlcHRUZXh0KGMgRkhJUi5Db2RlYWJsZUNvbmNlcHQpOgogIENvYWxlc2NlKGMudGV4dC52YWx1ZSwgQ29hbGVzY2UoKGMuY29kaW5nKSBjMiByZXR1cm4gYzIuZGlzcGxheS52YWx1ZSksIENvYWxlc2NlKChjLmNvZGluZykgYzMgcmV0dXJuIGMzLmNvZGUudmFsdWUpKQoKLy8gUmV0dXJucyBhIHRleHQgcmVwcmVzZW50YXRpb24gb2YgYSBRdWFudGl0eSB3aXRoIHRoZSBRdWFudGl0eSdzIHZhbHVlIGFuZCB1bml0LgovLyBJZiB0aGUgdW5pdCBpcyB7c2NvcmV9LCB0aGVuIG9taXQgaXQgKGFzIGl0IGlzIG5vdCB1c2VmdWwgdG8gZGlzcGxheSkKLy8gQHBhcmFtIHEgLSBhIEZISVIgUXVhbnRpdHkgdG8gZ2V0IHRleHQgZm9yCi8vIEByZXR1cm5zIHtTeXN0ZW0uU3RyaW5nfSB0aGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgUXVhbnRpdHkKZGVmaW5lIGZ1bmN0aW9uIFF1YW50aXR5VGV4dChxIEZISVIuUXVhbnRpdHkpOgogIGlmIChxIGlzIG51bGwpIHRoZW4gbnVsbAogIGVsc2UgaWYgKHEudW5pdCBpcyBub3QgbnVsbCBhbmQgcS51bml0LnZhbHVlICE9ICd7c2NvcmV9JykgdGhlbiBUb1N0cmluZyhxLnZhbHVlLnZhbHVlKSArICcgJyArIHEudW5pdC52YWx1ZQogIGVsc2UgaWYgKHEuY29kZSBpcyBub3QgbnVsbCBhbmQgcS5jb2RlLnZhbHVlICE9ICd7c2NvcmV9JykgdGhlbiBUb1N0cmluZyhxLnZhbHVlLnZhbHVlKSArICcgJyArIHEuY29kZS52YWx1ZQogIGVsc2UgVG9TdHJpbmcocS52YWx1ZS52YWx1ZSkKCmRlZmluZSBmdW5jdGlvbiBRdWFudGl0eVRleHRXaXRoQ29tcGFyYXRvcihxIEZISVIuUXVhbnRpdHkpOgogIGlmIChxIGlzIG51bGwpIHRoZW4gbnVsbAogIGVsc2UgaWYgKHEuY29tcGFyYXRvciBpcyBub3QgbnVsbCkgdGhlbiBxLmNvbXBhcmF0b3IudmFsdWUgKyAnICcgKyBRdWFudGl0eVRleHQocSkKICBlbHNlIFF1YW50aXR5VGV4dChxKQoKZGVmaW5lIGZ1bmN0aW9uIFJhbmdlVGV4dChyIEZISVIuUmFuZ2UpOgogIGlmIChyIGlzIG51bGwpIHRoZW4gbnVsbAogIGVsc2UgaWYgKHIubG93IGlzIG5vdCBudWxsIGFuZCByLmhpZ2ggaXMgbm90IG51bGwpIHRoZW4gJ2JldHdlZW4gJyArIFRvU3RyaW5nKHIubG93LnZhbHVlLnZhbHVlKSArICcgYW5kICcgKyBUb1N0cmluZyhyLmhpZ2gudmFsdWUudmFsdWUpCiAgZWxzZSBpZiAoci5sb3cgaXMgbm90IG51bGwgYW5kIHIuaGlnaCBpcyBudWxsKSB0aGVuICdhYm92ZSAnICsgVG9TdHJpbmcoci5sb3cudmFsdWUudmFsdWUpCiAgZWxzZSBpZiAoci5sb3cgaXMgbnVsbCBhbmQgci5oaWdoIGlzIG5vdCBudWxsKSB0aGVuICdiZWxvdyAnICsgVG9TdHJpbmcoci5oaWdoLnZhbHVlLnZhbHVlKQogIGVsc2UgbnVsbAoKLyoKICBIZWxwZXIgZnVuY3Rpb25zIHRvIGNvbnN0cnVjdCBVUkxzIGZvciBNZWRMaW5kUGx1cyBjb250ZW50LgoqLwoKLy8vIFJldHVybnMgd2ViIFVSTCBmb3IgTWVkbGluZVBsdXMgY29udGVudCB1c2luZyByZXNvdXJjZSBzeXN0ZW0vY29kZQpkZWZpbmUgZnVuY3Rpb24gTGVhcm5Nb3JlVVJMKGNvbmNlcHQgRkhJUi5Db2RlYWJsZUNvbmNlcHQpOgogIGlmIExlYXJuTW9yZUNvZGUoY29uY2VwdCkgaXMgbm90IG51bGwgdGhlbgogICAgJ2h0dHBzOi8vY29ubmVjdC5tZWRsaW5lcGx1cy5nb3YvYXBwbGljYXRpb24/JwogICAgICArICdtYWluU2VhcmNoQ3JpdGVyaWEudi5jcz0nICsgTGVhcm5Nb3JlQ29kZShjb25jZXB0KS5zeXN0ZW0KICAgICAgKyAnJm1haW5TZWFyY2hDcml0ZXJpYS52LmM9JyArIExlYXJuTW9yZUNvZGUoY29uY2VwdCkuY29kZQogIGVsc2UKICAgIG51bGwKCi8vIFJldHVybnMgYSBTeXN0ZW0uQ29kZSB3aXRoIHN5dGVtIGFuZCBjb2RlIHBhcmFtZXRlcnMgZm9yIHF1ZXJ5aW5nIE1lZGxpbmVQbHVzCmRlZmluZSBmdW5jdGlvbiBMZWFybk1vcmVDb2RlKGNvbmNlcHQgRkhJUi5Db2RlYWJsZUNvbmNlcHQpOgogIEZpcnN0KAogICAgY29uY2VwdC5jb2RpbmcgYwogICAgICBsZXQgbWVkbGluZUNvZGU6IE1lZGxpbmVQbHVzQ29kZShjKQogICAgICB3aGVyZSBtZWRsaW5lQ29kZSBpcyBub3QgbnVsbAogICAgICByZXR1cm4gbWVkbGluZUNvZGUKICApCgpkZWZpbmUgZnVuY3Rpb24gTWVkbGluZVBsdXNDb2RlKGMgRkhJUi5Db2RpbmcpOgogIGNhc2UKICAgIHdoZW4gYy5zeXN0ZW0udmFsdWUgPSAnaHR0cDovL2xvaW5jLm9yZycgb3IgYy5zeXN0ZW0udmFsdWUgPSAndXJuOm9pZDoyLjE2Ljg0MC4xLjExMzg4My42LjEnIHRoZW4KICAgICAgU3lzdGVtLkNvZGUgeyBzeXN0ZW06ICcyLjE2Ljg0MC4xLjExMzg4My42LjEnLCBjb2RlOiBjLmNvZGUudmFsdWUsIGRpc3BsYXk6IGMuZGlzcGxheS52YWx1ZSB9CiAgICB3aGVuIGMuc3lzdGVtLnZhbHVlID0gJ2h0dHA6Ly9zbm9tZWQuaW5mby9zY3QnIG9yIGMuc3lzdGVtLnZhbHVlID0gJ3VybjpvaWQ6Mi4xNi44NDAuMS4xMTM4ODMuNi45NicgdGhlbgogICAgICBTeXN0ZW0uQ29kZSB7IHN5c3RlbTogJzIuMTYuODQwLjEuMTEzODgzLjYuOTYnLCBjb2RlOiBjLmNvZGUudmFsdWUsIGRpc3BsYXk6IGMuZGlzcGxheS52YWx1ZSB9CiAgICB3aGVuIGMuc3lzdGVtLnZhbHVlID0gJ2h0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMC1jbScgb3IgYy5zeXN0ZW0udmFsdWUgPSAndXJuOm9pZDoyLjE2Ljg0MC4xLjExMzg4My42LjkwJyB0aGVuCiAgICAgIFN5c3RlbS5Db2RlIHsgc3lzdGVtOiAnMi4xNi44NDAuMS4xMTM4ODMuNi45MCcsIGNvZGU6IGMuY29kZS52YWx1ZSwgZGlzcGxheTogYy5kaXNwbGF5LnZhbHVlIH0KICAgIHdoZW4gYy5zeXN0ZW0udmFsdWUgPSAnaHR0cDovL3d3dy5ubG0ubmloLmdvdi9yZXNlYXJjaC91bWxzL3J4bm9ybScgb3IgYy5zeXN0ZW0udmFsdWUgPSAndXJuOm9pZDoyLjE2Ljg0MC4xLjExMzg4My42Ljg4JyB0aGVuCiAgICAgIFN5c3RlbS5Db2RlIHsgc3lzdGVtOiAnMi4xNi44NDAuMS4xMTM4ODMuNi44OCcsIGNvZGU6IGMuY29kZS52YWx1ZSwgZGlzcGxheTogYy5kaXNwbGF5LnZhbHVlIH0KICAgIHdoZW4gYy5zeXN0ZW0udmFsdWUgPSAnaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvbmRjJyBvciBjLnN5c3RlbS52YWx1ZSA9ICd1cm46b2lkOjIuMTYuODQwLjEuMTEzODgzLjYuNjknIHRoZW4KICAgICAgU3lzdGVtLkNvZGUgeyBzeXN0ZW06ICcyLjE2Ljg0MC4xLjExMzg4My42LjY5JywgY29kZTogYy5jb2RlLnZhbHVlLCBkaXNwbGF5OiBjLmRpc3BsYXkudmFsdWUgfQogICAgd2hlbiBjLnN5c3RlbS52YWx1ZSA9ICdodHRwOi8vd3d3LmFtYS1hc3NuLm9yZy9nby9jcHQnIG9yIGMuc3lzdGVtLnZhbHVlID0gJ3VybjpvaWQ6Mi4xNi44NDAuMS4xMTM4ODMuNi4xMicgdGhlbgogICAgICBTeXN0ZW0uQ29kZSB7IHN5c3RlbTogJzIuMTYuODQwLjEuMTEzODgzLjYuMTInLCBjb2RlOiBjLmNvZGUudmFsdWUsIGRpc3BsYXk6IGMuZGlzcGxheS52YWx1ZSB9CiAgICBlbHNlCiAgICAgIG51bGwKICBlbmQK"
  } ]
}